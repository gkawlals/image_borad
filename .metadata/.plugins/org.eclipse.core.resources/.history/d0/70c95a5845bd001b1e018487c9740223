package poly.util;

import java.io.ByteArrayInputStream;
import java.io.File;
import java.util.List;

import com.amazonaws.ClientConfiguration;
import com.amazonaws.Protocol;
import com.amazonaws.auth.AWSCredentials;
import com.amazonaws.auth.BasicAWSCredentials;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.AmazonS3Client;
import com.amazonaws.services.s3.model.Bucket;
import com.amazonaws.services.s3.model.ObjectMetadata;

public class FileUtil {
	
	private String accessKey = "AKIA2UNIAKDMR7V4K2OD";
	private String secretKey = "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";
	
	private AmazonS3 conn;
	
	public void S3Util() {
		AWSCredentials credentials = new BasicAWSCredentials(accessKey, secretKey);
		
		ClientConfiguration clientConfig = new ClientConfiguration();
		clientConfig.setProtocol(Protocol.HTTP);
		this.conn = new AmazonS3Client(credentials, clientConfig);
		conn.setEndpoint("s3.ap-northeast-2.amazonaws.com");
	}
	
	// 버킷 리스트 들고오기 
	public List<Bucket> getBucketList(){
		return conn.listBuckets();
	}
	// 버킷을 생성하기
	public Bucket createBucket(String circle) {
		return conn.createBucket(circle);
		
	}
	// 폴더 생성 ( 폴더는 파일명 뒤에 "/"를 붙여야 한다.) 
	public void createFolder(String bucketName, String folderName) {
		conn.putObject(bucketName, folderName + "/", new ByteArrayInputStream(new byte[0]), new ObjectMetadata());
	}
	
	public static String mkdirForDate ( String uploadDir) {
		
		String path = uploadDir + DateUtil.getDateTime("/yyyy/MM/dd");
		
		File Folder = new File(path);
		
		//파일이 존재 하지 않으면 폴더 생성
		if( !Folder.exists()) {
			
			Folder.mkdirs();// 폴더 생성
		}
		
		return path;
	}
	
}
